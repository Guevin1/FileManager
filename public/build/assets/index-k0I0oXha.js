import{d as $,p as k,o as p,h as w,e as l,u as h,E as I,t as y,G as N,F as M,H as E,a as L,w as U,f as B,i as P,l as R,I as D,n as S,b as K,c as O,J as T}from"./app-B5dnpVjm.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as z}from"./NavLink.vue_vue_type_script_setup_true_lang-BumCiDjf.js";const A=["path"],H=["src","alt"],V={class:"w-full text-left cursor-default"},j={key:0,class:"text-nowrap text-right"},G={key:1},q={class:"text-nowrap text-right"},J={class:"text-nowrap text-right"},X=$({__name:"FileComponent",props:{file:{type:Object,required:!0},path:{type:String,default:""},icon:{type:Number,default:64},isFull:{type:Boolean,default:!1},width:{type:Number,default:64},ctrl:{type:Boolean,default:!1}},setup(s){const a=s;let o=0,d=a.file.mimetype.replace("/","-");a.file.isFolder&&(d="folder-blue");let f=[d,d.replace("text","application"),d.replace("script.",""),"unknown"],c=a.path;const r="/storage/"+a.icon+"/";let m=k(r+f[o]+".svg"),i=0;const C=["b","Kb","Mb","Gb","Tb","Pb"];function g(t){if(t<1024){let u=C[i];return i=0,parseFloat(t.toString()).toFixed(1)+" "+u}return i++,g(t/1024)}function b(){o++,m.value=r+f[o]+".svg"}let _=c+"/"+a.file.name,x=route("files",{path:_});async function v(t){e(),a.file.isFolder?await N.visit(x):window.location.href=x}function n(t){(t.button==1||a.ctrl&&t.button==0)&&window.open(x)}function e(){const t=window.getSelection();if(t)t.removeAllRanges();else{const u=document.getSelection();u&&u.removeAllRanges()}}return(t,u)=>(p(),w("tr",{class:"text-white",onMousedown:n,path:h(_),onDblclick:v},[l("td",{style:I("min-width: "+a.width+"px")},[l("img",{src:h(m),class:"w-full",alt:h(d),onError:b},null,40,H)],4),l("td",V,y(s.file.name),1),s.file.isFolder?(p(),w("td",G)):(p(),w("td",j,y(g(a.file.size)),1)),l("td",q,y(new Date(Number(s.file.updated??0)*1e3).toLocaleString()),1),l("td",J,y(new Date(Number(s.file.updated??0)*1e3).toLocaleString()),1)],40,A))}}),Y=F(X,[["__scopeId","data-v-dc19661b"]]),Q={class:"flex flex-col sticky bg-[#31363b] text-white"},W={class:"flex w-full h-12"},Z={class:"flex w-full items-center gap-3"},ee={class:"h-10 flex gap-1 items-center pb-2 pt-2 ml-3 text-white"},te=["href"],le={key:0},ne=$({__name:"HeaderLayout",props:{path:{type:String,default:"/"}},setup(s){const a=s;let o="/",d=a.path.split("/"),f={"/":o};for(const c of d)c!=""&&(o+=c,f[o]=c);return(c,r)=>(p(),w("header",Q,[l("section",W,[l("div",Z,[r[0]||(r[0]=l("img",{class:"aspect-square h-full",src:"/storage/64/folder-blue.svg",alt:""},null,-1)),l("p",null,y(c.$page.props.name),1)]),r[1]||(r[1]=l("nav",{class:"w-full"},null,-1))]),l("section",ee,[(p(!0),w(M,null,E(h(f),(m,i)=>(p(),w("span",{class:"flex items-center gap-1",href:i},[L(z,{href:c.route("files",{path:i}),class:"p-3 pt-1 pb-1 transition hover:bg-emerald-400/10"},{default:U(()=>[B(y(m),1)]),_:2},1032,["href"]),Object.keys(h(f)).indexOf(i.toString())!=Object.keys(h(f)).length-1?(p(),w("span",le," > ")):P("",!0)],8,te))),256))])]))}}),oe={class:"border-collapse h-min"},se=$({__name:"index",props:{path:String,files:{type:Array}},setup(s){const a=s;let o=k(!1);const d=n=>{(n.key==="Control"||n.ctrlKey)&&!o.value&&(o.value=!0)},f=n=>{(n.key==="Control"||n.ctrlKey)&&(o.value=!1)};R(()=>{document.addEventListener("keydown",d),document.addEventListener("keyup",f)}),D(()=>{document.removeEventListener("keydown",d),document.removeEventListener("keyup",f)});let c=k(),r=!1,m=k(!1),i=k();function C(n){n.preventDefault(),console.log(n.target);let e=c.value;e.classList.remove("hidden"),e.style.top=n.clientY+"px",e.style.left=n.clientX+"px";let t=n.target;i.value=t.closest("[path]"),i.value?m.value=!0:m.value=!1}async function g(n){try{await navigator.clipboard.writeText(n)}catch(e){console.error("Не удалось скопировать текст:",e)}}function b(n){var u;console.log(i.value);let e=a.path,t=n+"";switch(i.value!=null&&(e=(u=i.value.attributes.getNamedItem("path"))==null?void 0:u.value,t="t"+n),t){case"topen":{window.location.href=route("files",{path:e});break}case"topenNew":{window.open(route("files",{path:e}));break}}switch(n){case"download":{window.open(route("download",{path:e}));break}case"copyURL":g(route("files",{path:e})),r=!1,v();case"copyURLdownload":g(route("download",{path:e})),r=!1,v()}}function _(){r=!0}function x(){r=!1}function v(){r||c.value.classList.add("hidden")}return(n,e)=>(p(),w(M,null,[L(h(K),{title:s.path+"/"},null,8,["title"]),l("main",{class:"h-[100vh]",onClick:v},[L(ne,{path:s.path},null,8,["path"]),l("section",{class:"grid h-full overflow-scroll bg-[#18191d]",onContextmenu:C},[l("table",oe,[(p(!0),w(M,null,E(s.files,t=>(p(),O(Y,{class:"h-12",ctrl:h(o),"onUpdate:ctrl":e[0]||(e[0]=u=>T(o)?o.value=u:o=u),path:s.path,file:t},null,8,["ctrl","path","file"]))),256))])],32),l("menu",{type:"context",ref_key:"contextMenu",ref:c,onMouseenter:_,onMouseleave:x,class:"absolute flex flex-col w-1/5 top-0 left-0 bg-[#23282c] rounded-md text-white hidden",style:{border:"1px solid #4c5155"}},[l("button",{class:S(["buttonMenu",{disable:!h(m)}]),onClick:e[1]||(e[1]=t=>b("open"))}," Открыть файл ",2),l("button",{class:S(["buttonMenu",{disable:!h(m)}]),onClick:e[2]||(e[2]=t=>b("openNew"))}," Открыть файл в новой вкладке ",2),e[6]||(e[6]=l("hr",{class:"border-[#3c464f]"},null,-1)),l("button",{class:"buttonMenu",onClick:e[3]||(e[3]=t=>b("download"))}," Скачать файл "),e[7]||(e[7]=l("hr",{class:"border-[#3c464f]"},null,-1)),l("button",{class:"buttonMenu",onClick:e[4]||(e[4]=t=>b("copyURL"))}," Скопировать ссылку "),l("button",{class:"buttonMenu",onClick:e[5]||(e[5]=t=>b("copyURLdownload"))}," Скопировать ссылку на скачивание ")],544)])],64))}}),ue=F(se,[["__scopeId","data-v-91e16094"]]);export{ue as default};
